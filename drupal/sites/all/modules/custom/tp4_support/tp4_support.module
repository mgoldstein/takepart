<?php
/**
 * @file
 * TakePart dule for functions related to the Nov 2013 redesign
 * of TakePart and the TP4 Theme.
 */

/**
 * Implements hook_help().
 */
function tp4_support_help($path, $arg) {
	switch ($path) {
		case 'admin/help#tp4_support':
			return '<p>' . t('Support module for the TP4 theme and the Nov, 2013 redesign.') . '</p>';		
	}
}

/**
* Implements hook_entity_info_alter().
*
* Add view modes for homepage content display.
*/
function tp4_support_entity_info_alter(&$entity_info) {
  $entity_info['node']['view modes']['feature_main'] = array(
    'label' => t('Main Feature'),
    'custom settings' => TRUE,
  );
  $entity_info['node']['view modes']['feature_secondary'] = array(
    'label' => t('Secondary Feature'),
    'custom settings' => TRUE,
  );
  $entity_info['node']['view modes']['feature_video'] = array(
    'label' => t('Video Feature'),
    'custom settings' => TRUE,
  );
}

/**
* Implements hook_preprocess_node().
*
* Add template suggestions for featured view modes.
*/
function tp4_support_preprocess_node(&$vars) {
  if($vars['view_mode'] == 'feature_main') {
	$vars['theme_hook_suggestions'][] = 'node__feature_main';
    $vars['theme_hook_suggestions'][] = 'node__' . $vars['type'] . '__feature_main';
  }
  if($vars['view_mode'] == 'feature_secondary') {
	$vars['theme_hook_suggestions'][] = 'node__feature_secondary';
    $vars['theme_hook_suggestions'][] = 'node__' . $vars['type'] . '__feature_secondary';
  }
  if($vars['view_mode'] == 'feature_video') {
	$vars['theme_hook_suggestions'][] = 'node__feature_video';
    $vars['theme_hook_suggestions'][] = 'node__' . $vars['type'] . '__feature_video';
  }

}

function tp4_support_block_info(){
  $blocks = array();
  $blocks['tp4_footer'] = array(
    'info' => t('Footer for Homepage Redesign'),
  );
  return $blocks;
}

function tp4_support_block_view($delta = ''){
  $block = array();
  switch($delta){
    case 'tp4_footer':
      $block['content'] = 'something';
      $block['content'] = tp4_support_hero();
    break;
  }
  return $block;
}
function tp4_support_block_configure($delta = ''){
  $form = array();
  if ($delta == 'tp4_footer') {
    $form['tp4_support_footer_text'] = array(
      '#type' => 'textarea',
      '#title' => t('Footer Text'),
      '#description' => t('Text for the footer region'),
      '#default_value' => variable_get('tp4_support_footer_text', t('TakePart is the digital division of Participant Media')),
    );
  }
  return $form;
}
function tp4_support_block_save($delta = '', $edit = array()) {
  if ($delta == 'tp4_footer') {
    variable_set('tp4_support_footer_text', $edit['tp4_support_footer_text']);
  }
}

function tp4_support_hero(){
  $footer_text = variable_get('tp4_support_footer_text', 'TakePart is the digital division of Participant Media');
  return theme('tp4_support_footer', array('footer_text' => $footer_text));
}

function tp4_support_theme() {
  return array(
    'tp4_support_footer' => array(
      'arguments' => array(),
      'variables' => array(
        'footer_text' => $footer_text,
      ),
      'template' => 'tp4-support-footer'
    )
  );
}
