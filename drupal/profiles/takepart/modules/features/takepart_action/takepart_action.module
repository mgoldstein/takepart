<?php
/**
 * @file
 * Code for the TakePart Action feature.
 */

include_once('takepart_action.features.inc');

function takepart_action_form_action_node_form_alter(&$form, &$form_state, $form_id) {
  drupal_add_css(
    ".field-name-field-action-sponsor.field-widget-node-reference-autocomplete input.form-autocomplete {width:90%!important;}",
    array('type' => 'inline')
  );
}

/*
 * implement hook_field_actach_load()
 *
 * we are adding a local link if there is no action url
 * we need to add this or no item will show.
 * JS makes sure that this link is not followed
 */
function takepart_action_field_attach_load($entity_type, $entities, $age, $options) {
  if ($entity_type == 'node') {
    foreach($entities as $entity) {
      if($entity->type == 'action' && empty($entity->field_action_url)) {
        $entity->field_action_url = array(
          $entity->language => array(array(
            'url' => 'local',
            'title' => t('Take Action'),
            'attributes' => array(),
          )),
        );
      }
    }
  }
}
/**
 * handle some node preprocessing.  remove submitted
 */
function takepart_action_preprocess_node(&$variables) {
  if($variables['type'] == 'action') {
    $variables['submitted'] = NULL;
  }
}
