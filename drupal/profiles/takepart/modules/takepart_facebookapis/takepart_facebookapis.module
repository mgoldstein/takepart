<?php

/**
* Implements hook_rdf_namespaces().
*/
function takepart_facebookapis_rdf_namespaces() {
  return array(
    'fb' => 'http://ogp.me/ns/fb#',
  );
}

/**
 * Implements hook_page_alter().
 */
function takepart_facebookapis_page_alter(&$page) {
  // Skip if the page is part of the admin.
  if (path_is_admin(current_path())) { return; }
  $app_id = variable_get('facebook_app_id');
  $page['page_bottom']['fb-init-code'] = array(
    '#type' => 'markup',
    '#markup' => takepart_facebookapis_init_code($app_id),
  );
}

function takepart_facebookapis_init_code($app_id) {
$code = <<<EOC
  <div id="fb-root"></div>
  <script type="text/javascript">
    window.fbAsyncInit = function() {
      FB.init({
        appId      : '{$app_id}',
        channelUrl : '//' + document.location.hostname + '/channel.php',
        status     : true,
        cookie     : true,
        xfbml      : true
      });
    };
    (function(d) {
      var js, id = 'facebook-jssdk'; if (d.getElementById(id)) {return;}
      js = d.createElement('script'); js.id = id; js.async = true;
      js.src = '//connect.facebook.net/en_US/all.js';
      d.getElementsByTagName('head')[0].appendChild(js);
    }(document));
  </script>
EOC;
return $code;
}
