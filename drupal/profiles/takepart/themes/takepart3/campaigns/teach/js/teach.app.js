/*! teach - v0.2.0 */ !function(a){"use strict";a.fn.extend({customSelect:function(b){if("undefined"==typeof document.body.style.maxHeight)return this;var c={customClass:"customSelect",mapClass:!0,mapStyle:!0},b=a.extend(c,b),d=b.customClass,e=function(b,c){var d=b.find(":selected"),e=c.children(":first"),g=d.html()||"&nbsp;";e.html(g),d.attr("disabled")?c.addClass(f("DisabledOption")):c.removeClass(f("DisabledOption")),setTimeout(function(){c.removeClass(f("Open")),a(document).off("mouseup."+f("Open"))},60)},f=function(a){return d+a};return this.each(function(){var c=a(this),g=a("<span />").addClass(f("Inner")),h=a("<span />");c.after(h.append(g)),h.addClass(d),b.mapClass&&h.addClass(c.attr("class")),b.mapStyle&&h.attr("style",c.attr("style")),c.addClass("hasCustomSelect").on("update",function(){e(c,h);var a=parseInt(c.outerWidth(),10)-(parseInt(h.outerWidth(),10)-parseInt(h.width(),10));h.css({display:"inline-block"});var b=h.outerHeight();c.attr("disabled")?h.addClass(f("Disabled")):h.removeClass(f("Disabled")),g.css({width:a,display:"inline-block"}),c.css({"-webkit-appearance":"menulist-button",width:h.outerWidth(),position:"absolute",opacity:0,height:b,fontSize:h.css("font-size")})}).on("change",function(){h.addClass(f("Changed")),e(c,h)}).on("keyup",function(a){h.hasClass(f("Open"))?(13==a.which||27==a.which)&&e(c,h):(c.blur(),c.focus())}).on("mousedown",function(){h.removeClass(f("Changed"))}).on("mouseup",function(b){h.hasClass(f("Open"))||(a("."+f("Open")).not(h).length>0&&"undefined"!=typeof InstallTrigger?c.focus():(h.addClass(f("Open")),b.stopPropagation(),a(document).one("mouseup."+f("Open"),function(b){b.target!=c.get(0)&&a.inArray(b.target,c.find("*").get())<0?c.blur():e(c,h)})))}).focus(function(){h.removeClass(f("Changed")).addClass(f("Focus"))}).blur(function(){h.removeClass(f("Focus")+" "+f("Open"))}).hover(function(){h.addClass(f("Hover"))},function(){h.removeClass(f("Hover"))}).trigger("update")})}})}(jQuery),function(a){var b=function(){try{return localStorage.setItem("foo","test"),localStorage.removeItem("test"),!0}catch(a){return!1}}(),c=b&&JSON.parse(localStorage.getItem("sysSchoolCache"))||{};a.extend(a.fn,{schoolBrowser:function(){return this.filter("form").each(function(){var d=a(this),e=d.find("#school_state"),f=d.find("#school_name"),g=d.find("#school_city"),h=d.find("#school_id"),i=a('<p class="character-count" />').addClass("character-count-school-name").insertAfter(f);a.fn.customSelect&&e.not(".hasCustomSelect").customSelect(),e.on("change",function(){f.attr("disabled",""===e.val())}),f.on("change",function(){f.data("autocompleteOpen")||(h.val("0"),g.val(""))}).on("blur",function(){f.removeClass("in-progress")});var j=function(){i.removeClass("count-warning").html("")},k=function(a,b){return f.val(b.item.label.split(" (")[0]),h.val(b.item.value.school_id),g.val(b.item.value.school_city),j(),!1};f.autocomplete({minLength:4,select:k,focus:k,blur:k,search:function(){f.addClass("in-progress"),j()},open:function(){f.removeClass("in-progress").data("autocompleteOpen",!0),j()},close:function(){j(),setTimeout(function(){f.data("autocompleteOpen",!1)},1e3)},source:function(d,g){var h=encodeURIComponent("&state="+e.val()+"&q="+encodeURIComponent(d.term));return h in c?void g(c[h]):void a.ajax({url:"/proxy?request="+encodeURIComponent("http://api.greatschools.org/search/schools/?key=zzlcyx4aijxe1nmnagoziqxx")+h,error:function(){var a=["We can't find &quot;"+d.term.htmlEntities()+"&quot;.","For best results, type a single, complete word and choose from the list."];f.removeClass("in-progress"),i.addClass("count-warning").html(a.join("<br/>"))},success:function(d){var e=[];a(d).find("school").each(function(){var b=a(this);e.push({label:b.find("name").text()+" ("+b.find("city").text()+", "+b.find("state").text()+")",value:{school_id:b.find("gsId").text(),school_city:b.find("city").text(),school_state:b.find("state").text()}})}),c[h]=e,b&&localStorage.setItem("sysSchoolCache",JSON.stringify(c)),g(e)}})}})})}})}(jQuery),function(){}(jQuery,this,this.document);