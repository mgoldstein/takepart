/*! teach - v0.2.0 */ !function(a){"use strict";a.fn.extend({customSelect:function(b){if("undefined"==typeof document.body.style.maxHeight)return this;var c={customClass:"customSelect",mapClass:!0,mapStyle:!0},b=a.extend(c,b),d=b.customClass,e=function(b,c){var d=b.find(":selected"),e=c.children(":first"),g=d.html()||"&nbsp;";e.html(g),d.attr("disabled")?c.addClass(f("DisabledOption")):c.removeClass(f("DisabledOption")),setTimeout(function(){c.removeClass(f("Open")),a(document).off("mouseup."+f("Open"))},60)},f=function(a){return d+a};return this.each(function(){var c=a(this),g=a("<span />").addClass(f("Inner")),h=a("<span />");c.after(h.append(g)),h.addClass(d),b.mapClass&&h.addClass(c.attr("class")),b.mapStyle&&h.attr("style",c.attr("style")),c.addClass("hasCustomSelect").on("update",function(){e(c,h);var a=parseInt(c.outerWidth(),10)-(parseInt(h.outerWidth(),10)-parseInt(h.width(),10));h.css({display:"inline-block"});var b=h.outerHeight();c.attr("disabled")?h.addClass(f("Disabled")):h.removeClass(f("Disabled")),g.css({width:a,display:"inline-block"}),c.css({"-webkit-appearance":"menulist-button",width:h.outerWidth(),position:"absolute",opacity:0,height:b,fontSize:h.css("font-size")})}).on("change",function(){h.addClass(f("Changed")),e(c,h)}).on("keyup",function(a){h.hasClass(f("Open"))?(13==a.which||27==a.which)&&e(c,h):(c.blur(),c.focus())}).on("mousedown",function(){h.removeClass(f("Changed"))}).on("mouseup",function(b){h.hasClass(f("Open"))||(a("."+f("Open")).not(h).length>0&&"undefined"!=typeof InstallTrigger?c.focus():(h.addClass(f("Open")),b.stopPropagation(),a(document).one("mouseup."+f("Open"),function(b){b.target!=c.get(0)&&a.inArray(b.target,c.find("*").get())<0?c.blur():e(c,h)})))}).focus(function(){h.removeClass(f("Changed")).addClass(f("Focus"))}).blur(function(){h.removeClass(f("Focus")+" "+f("Open"))}).hover(function(){h.addClass(f("Hover"))},function(){h.removeClass(f("Hover"))}).trigger("update")})}})}(jQuery),function(a){var b=function(){try{return localStorage.setItem("foo","test"),localStorage.removeItem("test"),!0}catch(a){return!1}}(),c=b&&JSON.parse(localStorage.getItem("sysSchoolCache"))||{};a.extend(a.fn,{schoolBrowser:function(){return this.filter("form").each(function(){var d=a(this),e=d.find("#school_state"),f=d.find("#school_name"),g=d.find("#school_city"),h=d.find("#school_id"),i=a('<p class="character-count" />').addClass("character-count-school-name").insertAfter(f),j=null;a.fn.customSelect&&(e.not(".hasCustomSelect").customSelect(),a(window).on("resize",function(){clearTimeout(j),j=setTimeout(function(){e.filter(".hasCustomSelect").trigger("update")},750)})),e.on("change",function(){f.attr("disabled",""===e.val())}),f.on("change",function(){f.data("autocompleteOpen")||(h.val("0"),g.val(""))}).on("blur",function(){f.removeClass("in-progress")});var k=function(){i.removeClass("count-warning").html("")},l=function(a,b){return f.val(b.item.label.split(" (")[0]),h.val(b.item.value.school_id),g.val(b.item.value.school_city),k(),!1};f.autocomplete({minLength:4,select:l,focus:l,blur:l,search:function(){f.addClass("in-progress"),k()},open:function(){f.removeClass("in-progress").data("autocompleteOpen",!0),k()},close:function(){k(),setTimeout(function(){f.data("autocompleteOpen",!1)},1e3)},source:function(d,g){var h=encodeURIComponent("&state="+e.val()+"&q="+encodeURIComponent(d.term));return h in c?void g(c[h]):void a.ajax({url:"/proxy?request="+encodeURIComponent("http://api.greatschools.org/search/schools/?key=zzlcyx4aijxe1nmnagoziqxx")+h,error:function(){var a=["We can't find &quot;"+d.term.htmlEntities()+"&quot;.","For best results, type a single, complete word and choose from the list."];f.removeClass("in-progress"),i.addClass("count-warning").html(a.join("<br/>"))},success:function(d){var e=[];a(d).find("school").each(function(){var b=a(this);e.push({label:b.find("name").text()+" ("+b.find("city").text()+", "+b.find("state").text()+")",value:{school_id:b.find("gsId").text(),school_city:b.find("city").text(),school_state:b.find("state").text()}})}),c[h]=e,b&&localStorage.setItem("sysSchoolCache",JSON.stringify(c)),g(e)}})}})})}})}(jQuery),function(a,b,c,d){a(d).ready(function(){var d=a("body");d.on("click","[data-storyid]",function(){c.location="/teach/stories#story/"+a(this).data("storyid")}).on("click","[data-schoolid]",function(){c.location="/teach/stories#school/"+a(this).data("schoolid")}),a("#browse-by-school").schoolBrowser().on("submit",function(b){b.preventDefault();var d=a(this),e=d.find("#school_id").val();c.location="/teach/stories#school/"+(0!=e?e:d.find("#school_state").val())});var e=a("#most-stories-nav"),f=a(".most-stories-list"),g=f.filter("#most-stories-latest"),h=f.filter("#most-stories-overall");f.hide().filter(":first").show(),e.find("a:first").addClass("active");var i=b.tmpl("most_stories_list_template"),j=[{id:1},{id:2},{id:3},{id:4},{id:5}];a.each(j,function(){a(i(this)).appendTo(g),a(i(this)).appendTo(h)}),e.on("click","a",function(a){a.preventDefault(),e.find("a").removeClass("active").filter(this).addClass("active"),f.hide().filter(a.target.hash).show()});var k=a(".teacher-story-stat");k.find(".campaign-stat").html("54,321"),a(".featured-stories").find(".featured-story").each(function(){var c=a(this),d=c.data("storyid");a.ajax("/proxy?request="+encodeURIComponent(b.TAP.postURL+"/"+d+"?action_id="+b.TAP.action_id+"&publisher_key="+b.TAP.partner_code),{success:function(a){a.teacher.image_uid||a.teacher.image_uid="sys-defaults/sys-default-"+Math.ceil(17*Math.random()),c.html(b.tmpl("featured_story_template",a)).on("click","a",function(a){a.stopPropagation()}).find("img").cloudinary()}})})})}(jQuery,TEACH,this,this.document);