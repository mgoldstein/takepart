<?php
/**
 * @file
 */
include_once('takepart_custom.features.inc');
include_once('takepart_custom.embeddable.inc');
include_once('takepart_custom.block.inc');
// Drupal needs this blank file.
//
/**
 * Implements hook_form_alter().
 */
 
function takepart_custom_form_node_form_alter(&$form, $form_state, $form_id) {
    drupal_add_css(drupal_get_path("module", 'takepart_custom') . "/takepart_custom.css");
    // Add access to the 'Publishing options' fieldset.
    $form['options']['promote']['#access'] = FALSE;
    $form['options']['sticky']['#access'] = FALSE;
    $form['revision_information']['revision']['#default_value'] = 1;
    $form['revision_information']['revision']['#access'] = FALSE;
}

/*
 * implements hook_field_attach_load()
 *
 * If we do not have topics but we have free tags we add
 * a dummy item to topic so it will still render
 * in the template.php we are combining free tags and topics for dislay
 *
 * this causes an expected notice of 
 * Notice: Undefined index: name in taxonomy_field_formatter_view() (line 1391 of /opt/development/esummerfield/www.takepart.com/drupal/modules/taxonomy/taxonomy.module).
 */
function takepart_custom_field_attach_load($entity_type, $entities, $age, $options) {
  if ($entity_type == 'node') {
    foreach($entities as $entity) {
        if (empty($entity->field_topic) && !empty($entity->field_free_tag)) {
          $entity->field_topic = array("und" => array(array("tid" => 0)));
        }
    }
  }
}

function takepart_custom_wysiwyg_editor_settings_alter(&$settings, &$context) {
  drupal_add_js(drupal_get_path("module", 'takepart_custom') ."/takepart_custom.js");
}
